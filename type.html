<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=672, height=288">
<title>Typing SVG Generator</title>
<style>
  body {
    font-family: "Noto Sans JP", sans-serif;
    background: #222;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 10px;
  }
  textarea, input {
    width: 90%;
    margin: 4px 0;
    padding: 6px;
    font-size: 14px;
    border-radius: 4px;
  }
  .color-row {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
  }
  label {
    font-weight: bold;
    margin-top: 6px;
  }
  .buttons {
    display: flex;
    gap: 10px;
    margin: 10px 0;
  }
  button {
    background: #0080ff;
    color: #fff;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
  }
  .output {
    width: 672px;
    height: 288px;
    border: 1px solid #555;
    background: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }
  pre {
    background: #111;
    color: #0f0;
    padding: 10px;
    width: 90%;
    overflow-x: auto;
    font-size: 12px;
  }
</style>
</head>
<body>
  <h2>Typing SVG Generator</h2>

  <label>変化前の文章（かななど） <small>例：れいとなる,ぶんしょう</small></label>
  <textarea id="textBefore" rows="2">れいとなる,ぶんしょう</textarea>

  <label>変化後の文章（漢字など） <small>例：例となる,文章</small></label>
  <textarea id="textAfter" rows="2">例となる,文章</textarea>

  <label>文字サイズ</label>
  <input type="number" id="fontSize" value="32">

  <div class="color-row">
    <div>
      <label for="fontColor">文字色</label><br>
      <input type="color" id="fontColor" value="#000000">
    </div>
    <div>
      <label for="bgColor">背景色</label><br>
      <input type="color" id="bgColor" value="#ffffff">
    </div>
  </div>

  <div class="buttons">
    <button id="generate">SVGを生成</button>
    <button id="copyCode">コードをコピー</button>
    <button id="saveFile">保存</button>
  </div>

  <div class="output" id="preview">SVGプレビュー</div>

  <h3>SVGコード</h3>
  <pre id="svgCode"></pre>

<script>
document.getElementById("generate").onclick = function() {
  const before = document.getElementById("textBefore").value.split(",");
  const after = document.getElementById("textAfter").value.split(",");
  const fontSize = document.getElementById("fontSize").value;
  const fontColor = document.getElementById("fontColor").value;
  const bgColor = document.getElementById("bgColor").value;

  let svg = `
<svg xmlns="http://www.w3.org/2000/svg" width="672" height="288" viewBox="0 0 672 288">
<style>
  text {
    font-family: 'Noto Sans JP', sans-serif;
    font-size: ${fontSize}px;
    fill: ${fontColor};
  }
  .dashed { text-decoration: underline dashed ${fontColor}; }
  .solid { text-decoration: underline solid ${fontColor}; }
  .cursor { animation: blink 1s steps(1) infinite; }
  @keyframes blink { 50% { opacity: 0; } }
</style>
<rect width="100%" height="100%" fill="${bgColor}"/>
<g id="typing"></g>
<script><![CDATA[
  const beforeLines = ${JSON.stringify(before)};
  const afterLines = ${JSON.stringify(after)};
  const g = document.getElementById('typing');
  const lineHeight = ${fontSize} * 1.5;
  const speed = 150;
  let line = 0, i = 0, phase = 0;
  const cursor = document.createElementNS('http://www.w3.org/2000/svg','rect');
  cursor.setAttribute('width', 2);
  cursor.setAttribute('height', ${fontSize});
  cursor.setAttribute('fill', '${fontColor}');
  cursor.setAttribute('class', 'cursor');
  g.appendChild(cursor);
  
  const textEl = document.createElementNS('http://www.w3.org/2000/svg','text');
  textEl.setAttribute('x', 20);
  textEl.setAttribute('y', 60);
  textEl.setAttribute('class', 'dashed');
  g.appendChild(textEl);

  function nextChar() {
    if (line >= beforeLines.length) return;
    const kana = beforeLines[line];
    const kanji = afterLines[line] || '';
    if (phase === 0 && i <= kana.length) {
      textEl.textContent = kana.slice(0, i);
      cursor.setAttribute('x', 20 + i * ${fontSize} * 0.6);
      cursor.setAttribute('y', 60 + lineHeight * line - ${fontSize});
      i++;
      setTimeout(nextChar, speed);
    } else if (phase === 0 && i > kana.length) {
      textEl.setAttribute('class', 'solid');
      textEl.textContent = kanji;
      phase = 1;
      i = 0;
      line++;
      if (line < beforeLines.length) {
        setTimeout(() => {
          const newText = textEl.cloneNode();
          newText.setAttribute('y', 60 + lineHeight * line);
          newText.setAttribute('class', 'dashed');
          g.appendChild(newText);
          textEl.replaceWith(newText);
          cursor.setAttribute('y', 60 + lineHeight * line - ${fontSize});
          setTimeout(nextChar, 800);
        }, 500);
      }
    }
  }
  nextChar();
]]></script>
</svg>`;

  document.getElementById("preview").innerHTML = svg;
  document.getElementById("svgCode").textContent = svg;
};

// コードをコピー
document.getElementById("copyCode").onclick = function() {
  const code = document.getElementById("svgCode").textContent;
  navigator.clipboard.writeText(code);
  alert("SVGコードをコピーしました！");
};

// ファイル保存
document.getElementById("saveFile").onclick = function() {
  const code = document.getElementById("svgCode").textContent;
  const blob = new Blob([code], { type: "image/svg+xml" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "typing.svg";
  a.click();
};
</script>
</body>
</html>
