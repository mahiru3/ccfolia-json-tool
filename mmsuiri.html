<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>é»’æ¿ãƒãƒ§ãƒ¼ã‚¯é¢¨SVGã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
<style>
body { font-family: sans-serif; background:#202020; color:white; text-align:center; padding:2em; }
textarea { width: 90%; height: 6em; font-size: 1.2em; }
button { margin: 1em; padding: 0.8em 1.5em; font-size: 1em; cursor: pointer; }
#preview { margin-top: 2em; background:#111; display:inline-block; }
</style>
</head>
<body>

<h1>ğŸ§ª é»’æ¿ãƒãƒ§ãƒ¼ã‚¯é¢¨SVGã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
<p>ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ã€Œç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
<textarea id="textInput">ã“ã“ã«æ–‡å­—ã‚’ã†ã£ã¦ç”Ÿæˆã™ã‚Œã°ã„ã„ã‚ˆ
ã€€ã€€ã€€æ”¹è¡Œã‚‚ãã®ã¾ã¾åæ˜ ã•ã‚Œã‚‹ã‚ˆã€‚</textarea><br>
<button id="genBtn">â–¶ ç”Ÿæˆ</button>
<button id="dlBtn" disabled>ğŸ’¾ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>

<div id="preview"></div>

<script>
document.getElementById("genBtn").onclick = () => {
  const text = document.getElementById("textInput").value;
  const lines = text.split(/\n/);
  const W=1600, H=900, MARGIN_X=120, MARGIN_Y=160, FONT_SIZE=44, LINE_H=Math.round(FONT_SIZE*1.6);
  const BASE_DELAY=0.18, DUR=0.45, RISE=10;

  const textElems = lines.map((line,i)=>{
    const y = MARGIN_Y + i*LINE_H;
    const begin = `${(i*BASE_DELAY).toFixed(2)}s`;
    return `
    <text class="chalkText" x="${MARGIN_X}" y="${y}" opacity="0">${line}
      <animate attributeName="opacity" from="0" to="1" dur="${DUR}s" begin="${begin}" fill="freeze"/>
      <animateTransform attributeName="transform" type="translate" from="0,${RISE}" to="0,0" dur="${DUR}s" begin="${begin}" fill="freeze"/>
    </text>`;
  }).join("");

  const svg = `<?xml version="1.0" encoding="UTF-8"?>
  <svg xmlns="http://www.w3.org/2000/svg" width="${W}" height="${H}" viewBox="0 0 ${W} ${H}">
  <defs>
    <linearGradient id="boardGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="#173628"/>
      <stop offset="0.65" stop-color="#1b402d"/>
      <stop offset="1" stop-color="#123021"/>
    </linearGradient>
    <filter id="boardNoise" x="-20%" y="-20%" width="140%" height="140%">
      <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" seed="8" result="n"/>
      <feColorMatrix in="n" type="saturate" values="0.25"/>
      <feComponentTransfer><feFuncA type="table" tableValues="0 0.04 0.06"/></feComponentTransfer>
    </filter>
    <filter id="chalk" x="-20%" y="-20%" width="140%" height="140%">
      <feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="1" seed="11" result="turb"/>
      <feDisplacementMap in="SourceGraphic" in2="turb" scale="1.2" xChannelSelector="R" yChannelSelector="G"/>
      <feGaussianBlur stdDeviation="0.25"/>
    </filter>
    <linearGradient id="chalkWhite" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="#ffffff"/><stop offset="1" stop-color="#f4f4f4"/>
    </linearGradient>
    <style><![CDATA[
      .chalkText {
        fill: url(#chalkWhite);
        font-family: "Noto Sans JP","Hiragino Sans","Yu Gothic Medium","Yu Gothic","Meiryo",sans-serif;
        font-weight: 700;
        letter-spacing: 0.02em;
        filter: url(#chalk);
        paint-order: stroke fill;
        stroke: #ffffff;
        stroke-width: 0.2px;
        font-size: ${FONT_SIZE}px;
      }
    ]]></style>
  </defs>
  <rect width="${W}" height="${H}" fill="url(#boardGrad)"/>
  <rect width="${W}" height="${H}" fill="#000" opacity="0.22" filter="url(#boardNoise)"/>
  ${textElems}
  </svg>`;

  const preview = document.getElementById("preview");
  preview.innerHTML = svg;
  document.getElementById("dlBtn").disabled = false;

  // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã«åå¿œ
  document.getElementById("dlBtn").onclick = () => {
    const blob = new Blob([svg], {type: "image/svg+xml"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `chalkboard_${Date.now()}.svg`;
    a.click();
    URL.revokeObjectURL(url);
  };
};
</script>

</body>
</html>
